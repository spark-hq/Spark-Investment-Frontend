{"version":3,"file":"useInvestments-Do-0LTKG.js","sources":["../../src/hooks/useInvestments.js"],"sourcesContent":["// ===================================\r\n// Investment Hooks - React Query hooks for investment data\r\n// ===================================\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { useMemo } from 'react';\r\nimport { investmentsAPI } from '../services/api';\r\nimport useStore from '../store/useStore';\r\n\r\n// ===================================\r\n// Query Hooks\r\n// ===================================\r\n\r\n// Get all investments\r\nexport const useInvestments = () => {\r\n  const setInvestments = useStore((state) => state.setInvestments);\r\n\r\n  return useQuery({\r\n    queryKey: ['investments'],\r\n    queryFn: async () => {\r\n      const response = await investmentsAPI.getAll();\r\n\r\n      // Use holdings array which contains all investments\r\n      // If holdings doesn't exist, combine the separated arrays\r\n      const allInvestments = response.data.holdings || [\r\n        ...(response.data.stocks || []),\r\n        ...(response.data.mutualFunds || []),\r\n        ...(response.data.crypto || []),\r\n      ];\r\n\r\n      setInvestments(allInvestments);\r\n      return allInvestments;\r\n    },\r\n    staleTime: 30000, // 30 seconds\r\n    refetchInterval: 60000, // Refetch every minute\r\n  });\r\n};\r\n\r\n// Get investment by ID\r\nexport const useInvestment = (id) => {\r\n  return useQuery({\r\n    queryKey: ['investment', id],\r\n    queryFn: async () => {\r\n      const response = await investmentsAPI.getById(id);\r\n      return response.data;\r\n    },\r\n    enabled: !!id, // Only run if ID exists\r\n    staleTime: 30000,\r\n  });\r\n};\r\n\r\n// Get stocks only\r\nexport const useStocks = () => {\r\n  return useQuery({\r\n    queryKey: ['investments', 'stocks'],\r\n    queryFn: async () => {\r\n      const response = await investmentsAPI.getStocks();\r\n      return response.data;\r\n    },\r\n    staleTime: 30000,\r\n    refetchInterval: 60000,\r\n  });\r\n};\r\n\r\n// Get mutual funds only\r\nexport const useMutualFunds = () => {\r\n  return useQuery({\r\n    queryKey: ['investments', 'mutualFunds'],\r\n    queryFn: async () => {\r\n      const response = await investmentsAPI.getMutualFunds();\r\n      return response.data;\r\n    },\r\n    staleTime: 30000,\r\n    refetchInterval: 60000,\r\n  });\r\n};\r\n\r\n// Get crypto only\r\nexport const useCrypto = () => {\r\n  return useQuery({\r\n    queryKey: ['investments', 'crypto'],\r\n    queryFn: async () => {\r\n      const response = await investmentsAPI.getCrypto();\r\n      return response.data;\r\n    },\r\n    staleTime: 30000,\r\n    refetchInterval: 60000,\r\n  });\r\n};\r\n\r\n// ===================================\r\n// Mutation Hooks\r\n// ===================================\r\n\r\n// Add new investment\r\nexport const useAddInvestment = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: (investment) => investmentsAPI.add(investment),\r\n    onSuccess: () => {\r\n      // Invalidate and refetch investments\r\n      queryClient.invalidateQueries(['investments']);\r\n    },\r\n  });\r\n};\r\n\r\n// Update investment\r\nexport const useUpdateInvestment = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: ({ id, updates }) => investmentsAPI.update(id, updates),\r\n    onSuccess: (data, variables) => {\r\n      // Invalidate specific investment and list\r\n      queryClient.invalidateQueries(['investment', variables.id]);\r\n      queryClient.invalidateQueries(['investments']);\r\n    },\r\n  });\r\n};\r\n\r\n// Delete investment\r\nexport const useDeleteInvestment = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: (id) => investmentsAPI.delete(id),\r\n    onSuccess: () => {\r\n      // Invalidate investments list\r\n      queryClient.invalidateQueries(['investments']);\r\n    },\r\n  });\r\n};\r\n\r\n// ===================================\r\n// Helper hook for investment summary\r\n// ===================================\r\nexport const useInvestmentSummary = (investments = []) => {\r\n  // Memoize expensive calculations to prevent recalculation on every render\r\n  return useMemo(() => {\r\n    if (!investments || investments.length === 0) {\r\n      return {\r\n        totalInvested: 0,\r\n        totalCurrentValue: 0,\r\n        totalReturns: 0,\r\n        overallReturnsPercentage: 0,\r\n        profitableInvestments: 0,\r\n        lossInvestments: 0,\r\n      };\r\n    }\r\n\r\n    const totalInvested = investments.reduce((sum, inv) => sum + (inv.investedAmount || inv.invested || 0), 0);\r\n    const totalCurrentValue = investments.reduce((sum, inv) => sum + (inv.currentValue || 0), 0);\r\n    const totalReturns = totalCurrentValue - totalInvested;\r\n    const overallReturnsPercentage = totalInvested > 0\r\n      ? ((totalReturns / totalInvested) * 100).toFixed(2)\r\n      : 0;\r\n\r\n    const profitableInvestments = investments.filter(inv => {\r\n      const returns = (inv.currentValue || 0) - (inv.investedAmount || inv.invested || 0);\r\n      return returns > 0;\r\n    }).length;\r\n\r\n    const lossInvestments = investments.filter(inv => {\r\n      const returns = (inv.currentValue || 0) - (inv.investedAmount || inv.invested || 0);\r\n      return returns < 0;\r\n    }).length;\r\n\r\n    return {\r\n      totalInvested,\r\n      totalCurrentValue,\r\n      totalReturns,\r\n      overallReturnsPercentage,\r\n      profitableInvestments,\r\n      lossInvestments,\r\n    };\r\n  }, [investments]); // Only recalculate when investments array changes\r\n};\r\n"],"names":["useInvestments","setInvestments","useStore","state","useQuery","response","investmentsAPI","allInvestments","useInvestmentSummary","investments","useMemo","totalInvested","sum","inv","totalCurrentValue","totalReturns","overallReturnsPercentage","profitableInvestments","lossInvestments"],"mappings":"8KAaY,MAACA,EAAiB,IAAM,CAClC,MAAMC,EAAiBC,EAAUC,GAAUA,EAAM,cAAc,EAE/D,OAAOC,EAAS,CACd,SAAU,CAAC,aAAa,EACxB,QAAS,SAAY,CACnB,MAAMC,EAAW,MAAMC,EAAe,SAIhCC,EAAiBF,EAAS,KAAK,UAAY,CAC/C,GAAIA,EAAS,KAAK,QAAU,GAC5B,GAAIA,EAAS,KAAK,aAAe,GACjC,GAAIA,EAAS,KAAK,QAAU,EACpC,EAEM,OAAAJ,EAAeM,CAAc,EACtBA,CACT,EACA,UAAW,IACX,gBAAiB,GACrB,CAAG,CACH,EAqGaC,EAAuB,CAACC,EAAc,KAE1CC,EAAAA,QAAQ,IAAM,CACnB,GAAI,CAACD,GAAeA,EAAY,SAAW,EACzC,MAAO,CACL,cAAe,EACf,kBAAmB,EACnB,aAAc,EACd,yBAA0B,EAC1B,sBAAuB,EACvB,gBAAiB,CACzB,EAGI,MAAME,EAAgBF,EAAY,OAAO,CAACG,EAAKC,IAAQD,GAAOC,EAAI,gBAAkBA,EAAI,UAAY,GAAI,CAAC,EACnGC,EAAoBL,EAAY,OAAO,CAACG,EAAKC,IAAQD,GAAOC,EAAI,cAAgB,GAAI,CAAC,EACrFE,EAAeD,EAAoBH,EACnCK,EAA2BL,EAAgB,GAC3CI,EAAeJ,EAAiB,KAAK,QAAQ,CAAC,EAChD,EAEEM,EAAwBR,EAAY,OAAOI,IAC9BA,EAAI,cAAgB,IAAMA,EAAI,gBAAkBA,EAAI,UAAY,GAChE,CAClB,EAAE,OAEGK,EAAkBT,EAAY,OAAOI,IACxBA,EAAI,cAAgB,IAAMA,EAAI,gBAAkBA,EAAI,UAAY,GAChE,CAClB,EAAE,OAEH,MAAO,CACL,cAAAF,EACA,kBAAAG,EACA,aAAAC,EACA,yBAAAC,EACA,sBAAAC,EACA,gBAAAC,CACN,CACE,EAAG,CAACT,CAAW,CAAC"}